<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Forecast App</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4 max-w-4xl">
      <h1 class="text-3xl font-bold text-center mb-6">Weather Forecast</h1>

      <!-- Search Form -->
      <div class="mb-6 flex justify-center">
        <input
          type="text"
          id="cityInput"
          placeholder="Enter city name"
          class="p-2 border rounded-l-md w-64 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button
          id="searchBtn"
          class="bg-blue-500 text-white p-2 rounded-r-md hover:bg-blue-600"
        >
          Search
        </button>
        <button
          id="locationBtn"
          class="bg-green-500 text-white p-2 ml-2 rounded-md hover:bg-green-600"
        >
          Use My Location
        </button>
      </div>

      <!-- Error Message -->
      <div id="error" class="text-red-500 text-center hidden mb-4"></div>

      <!-- Current Weather -->
      <div
        id="currentWeather"
        class="bg-white p-6 rounded-lg shadow-md mb-6 hidden"
      >
        <h2 class="text-2xl font-semibold mb-4">Current Weather</h2>
        <div class="flex items-center">
          <img
            id="currentIcon"
            src=""
            alt="Weather Icon"
            class="w-16 h-16 mr-4"
          />
          <div>
            <p id="cityName" class="text-xl font-medium"></p>
            <p id="temperature" class="text-lg"></p>
            <p id="description" class="text-gray-600"></p>
            <p id="humidity" class="text-gray-600"></p>
            <p id="wind" class="text-gray-600"></p>
          </div>
        </div>
      </div>

      <!-- 5-Day Forecast -->
      <div id="forecast" class="bg-white p-6 rounded-lg shadow-md hidden">
        <h2 class="text-2xl font-semibold mb-4">5-Day Forecast</h2>
        <div
          id="forecastContainer"
          class="grid grid-cols-1 sm:grid-cols-5 gap-4"
        ></div>
      </div>
    </div>

    <script>

      const API_KEY = "83688fade7434c76c4780c58d13fdb6d"; 
      const searchBtn = document.getElementById("searchBtn");
      const locationBtn = document.getElementById("locationBtn");
      const cityInput = document.getElementById("cityInput");
      const errorDiv = document.getElementById("error");
      const currentWeatherDiv = document.getElementById("currentWeather");
      const forecastDiv = document.getElementById("forecast");
      const forecastContainer = document.getElementById("forecastContainer");

      // Fetch weather by city name
      async function getWeatherByCity(city) {
        try {
          const currentResponse = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric`
          );
          if (!currentResponse.ok) throw new Error("City not found");
          const currentData = await currentResponse.json();

          const forecastResponse = await fetch(
            `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${API_KEY}&units=metric`
          );
          if (!forecastResponse.ok) throw new Error("Forecast not available");
          const forecastData = await forecastResponse.json();

          displayCurrentWeather(currentData);
          displayForecast(forecastData);
          errorDiv.classList.add("hidden");
        } catch (error) {
          showError(error.message);
        }
      }

      // Display current weather
      function displayCurrentWeather(data) {
        console.log(data)
        document.getElementById(
          "cityName"
        ).textContent = `${data.name}, ${data.sys.country}`;
        document.getElementById(
          "temperature"
        ).textContent = `Temperature: ${Math.round(data.main.temp)}°C`;
        document.getElementById(
          "description"
        ).textContent = `Condition: ${data.weather[0].description}`;
        document.getElementById(
          "humidity"
        ).textContent = `Humidity: ${data.main.humidity}%`;
        document.getElementById(
          "wind"
        ).textContent = `Wind: ${data.wind.speed} m/s`;
        document.getElementById(
          "currentIcon"
        ).src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
        currentWeatherDiv.classList.remove("hidden");
      }

      // Display 5-day forecast
      function displayForecast(data) {
        forecastContainer.innerHTML = "";
        // console.log(data.list);
        const dailyData = data.list.filter((reading) =>
          reading.dt_txt.includes("12:00:00")
        );
        // console.log(dailyData);

        dailyData.forEach((day) => {
          const date = new Date(day.dt * 1000);
          const dayDiv = document.createElement("div");
          dayDiv.className = "text-center m-1 py-2 border border-indigo-400 rounded";
          dayDiv.innerHTML = `
                    <p class="font-medium">${date.toLocaleDateString("en-US", {
                      weekday: "short",
                    })}</p>
                    <img src="https://openweathermap.org/img/wn/${
                      day.weather[0].icon
                    }.png" alt="Weather Icon" class="mx-auto w-12 h-12">
                    <p>${Math.round(day.main.temp)}°C</p>
                    <p class="text-sm text-gray-600">${
                      day.weather[0].description
                    }</p>
                `;
          forecastContainer.appendChild(dayDiv);
        });
        forecastDiv.classList.remove("hidden");
      }

      // Show error message
      function showError(message) {
        errorDiv.textContent = message;
        errorDiv.classList.remove("hidden");
        currentWeatherDiv.classList.add("hidden");
        forecastDiv.classList.add("hidden");
      }

      // Event listeners
      searchBtn.addEventListener("click", () => {
        const city = cityInput.value.trim();
        if (city) getWeatherByCity(city);
        else showError("Please enter a city name");
      });

      // Allow Enter key to trigger search
      cityInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          const city = cityInput.value.trim();
          if (city) getWeatherByCity(city);
          else showError("Please enter a city name");
        }
      });
    </script>
  </body>
</html>
